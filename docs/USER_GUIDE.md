# Rabbit Loc - 게임 로컬라이징 자동화 툴 사용 가이드

> 구글 스프레드시트 기반 게임 텍스트를 AI로 자동 번역/검수하는 웹 툴

---

## 개요

Rabbit Loc은 구글 스프레드시트에 작성된 한국어 게임 텍스트를 영어(EN)와 일본어(JA)로 자동 번역하고, AI 검수를 거쳐 시트에 반영하는 내부 자동화 툴입니다.

### 주요 특징

- **AI 한국어 사전 검수**: 번역 전 한국어 원문의 맞춤법/띄어쓰기를 자동 분석
- **다국어 자동 번역**: 한국어 → 영어, 일본어 동시 번역 (Grok 4.1 Fast Reasoning)
- **3단계 자동 검수**: Glossary 적용 → 태그 정규식 검증 → AI 품질 검토
- **2단계 사람 승인(HITL)**: 한국어 검수 승인 + 최종 번역 승인으로 안전한 반영
- **실시간 진행률**: 번역 과정을 실시간으로 화면에서 확인 가능
- **원본 자동 백업**: 작업 시작 전 자동으로 원본 데이터 백업

---

## 시작하기

### 1. 봇 이메일 초대

번역 대상 구글 스프레드시트에 아래 봇 이메일을 **편집자** 권한으로 초대해야 합니다.

```
local-agent@local-488014.iam.gserviceaccount.com
```

> 시트의 [공유] 버튼을 누르고 위 이메일을 편집자로 추가하세요.

### 2. 시트 URL 연결

1. 화면의 Google Sheet URL 입력란에 스프레드시트 URL을 붙여넣기합니다.
2. 자동으로 연결되며, 사용 가능한 시트 탭 목록이 드롭다운에 표시됩니다.
3. 마지막으로 사용한 URL은 자동 저장되어 다음 접속 시 불러옵니다.

### 3. 시트 탭 선택

드롭다운에서 번역할 시트 탭을 선택합니다.

- **All Sheets**: 모든 시트 탭을 순차적으로 자동 처리
- **개별 탭**: 특정 시트 탭만 선택하여 처리

> 아래 시트는 시스템에서 자동으로 필터링되어 드롭다운에 표시되지 않습니다:
> `사용법`, `Texture`, `수정금지_Common`

### 4. 작업 모드 선택

화면 하단의 모드 토글에서 작업 모드를 선택합니다.

| 모드 | 설명 | 용도 |
|------|------|------|
| **All (전체 번역)** | 기존 번역 유무와 상관없이 모든 행을 재번역 | 리뉴얼, 전체 재검수 |
| **New (신규 번역)** | 번역 컬럼이 비어있는 행만 번역 | 신규 텍스트 추가, 비용 절감 |

### 5. Row Range 설정 (선택사항)

특정 행 범위만 번역하고 싶을 때 Start와 End 값을 입력합니다.

- 비워두면 전체 행을 자동 처리합니다.
- All Sheets 모드에서는 Row Range가 비활성화됩니다.

---

## 작업 흐름 (5 Steps)

### Step 1: Load (데이터 로드)

"Load Data" 버튼을 클릭하면 아래 작업이 자동으로 진행됩니다:

1. **시트 데이터 로드**: 선택한 시트의 전체 데이터를 불러옵니다.
2. **원본 백업**: 작업 전 원본 데이터를 자동 백업합니다.
3. **한국어 분석 시작**: AI가 한국어 원문의 맞춤법/띄어쓰기를 분석합니다.

**화면 구성**:
- 프로그레스바: 로드 → 분석 진행률 표시
- 테이블: 원본 데이터가 실시간으로 표시되며, AI 분석 결과가 행별로 채워집니다.
- 각 행의 상태: Pending(대기) → Reviewing(분석 중) → OK(이상 없음) / Revised(수정 제안)

---

### Step 2: KR Review (한국어 검수)

AI가 분석을 완료하면 한국어 검수 화면으로 전환됩니다.

**화면 구성**:
- 프로그레스바: 검수 확인 진행률
- 테이블: AI가 제안한 수정사항 목록
  - **AI Note**: AI의 수정 이유 (아이콘 클릭 시 상세 내용 확인)
  - **Original (Korean)**: 기존 한국어 원문
  - **AI Suggested Fix**: AI가 제안한 수정본 (변경 부분 초록색 하이라이트)
  - **Action**: Accept(수락) / Reject(거부) 버튼

**사용 방법**:
1. 각 수정 제안을 확인하고 Accept(수락) 또는 Reject(거부)를 선택합니다.
2. "Filter: Issues Only" 토글로 수정 제안이 있는 항목만 필터링할 수 있습니다.
3. 확인이 끝나면 "Confirm & Next Step" 버튼을 클릭합니다.
4. 미확인 항목이 남아있으면 자동으로 Accept(수락) 처리됩니다.

> AI 수정 제안이 0건이면 이 단계를 자동으로 건너뜁니다.

---

### Step 3: Translating (번역 진행)

한국어 검수 승인 후 자동으로 번역이 시작됩니다.

**번역 파이프라인**:
1. **Translator**: AI가 한국어 → 영어/일본어 번역 수행
2. **Reviewer**: 번역 결과를 3단계로 자동 검수
   - Glossary 용어 강제 적용
   - 태그({변수}, \<color\> 등) 보존 여부 정규식 검증
   - AI 품질 검토 (의미 정확성, 톤 일관성)
3. 검수 실패 시 최대 **3회 자동 재시도**

**화면 구성**:
- 프로그레스바: 번역(0~60%) → 검수(60~95%) → 완료(100%)
- 파이프라인 시각화: Translator → Reviewer → Complete (현재 단계 강조)
- 테이블: 번역 결과가 실시간으로 채워집니다.

**번역 취소**:
- "Cancel" 버튼으로 번역을 취소하면 이전 단계(한국어 검수)로 복귀합니다.
- 이미 완료된 한국어 검수 결과는 유지됩니다.

---

### Step 4: Multi-Review (번역 검수)

번역과 검수가 완료되면 최종 검수 화면으로 전환됩니다.

**화면 구성**:
- 통계 카드: 전체 문자열 수, 변경된 항목, 미변경 항목, 예상 비용
- 언어별 탭: EN(영어) / JA(일본어) 탭으로 전환하여 확인
- 테이블:
  - **AI Note**: AI의 번역/검수 메모
  - **Source (KR)**: 한국어 원문
  - **Previous Translation**: 기존 번역 (변경 시 취소선 표시)
  - **New Translation**: 새 번역 (변경 부분 초록색 하이라이트)
  - **Action**: Accept / Reject 버튼 (변경된 항목만 활성)

**사용 방법**:
1. 언어 탭을 전환하며 번역 결과를 확인합니다.
2. 각 항목별로 Accept/Reject를 선택하거나, "Approve Page"로 현재 페이지를 일괄 승인합니다.
3. 확인이 끝나면:
   - **"Confirm & Push to Sheet"**: 승인 후 다음 단계로 진행
   - **"Discard"**: 번역 결과를 폐기하고 초기 화면으로 복귀

---

### Step 5: Complete (완료)

**요약 카드**:
- 번역 성공 상태 표시
- 처리된 행 수, 대상 언어 수, 실패 항목 수

**통계 카드 (4개)**:
| 항목 | 설명 |
|------|------|
| **Tokens Used** | AI 처리에 사용된 토큰 수 |
| **Rows Translated** | 번역된 행 수 + 언어 수 |
| **Cells Updated** | 시트에 업데이트된 셀 수 |
| **Total Cost** | 예상 API 비용 (USD) |

**최종 액션**:
- **"Push to Sheets"**: 번역 결과를 구글 시트에 반영
- **"Export JSON"**: 번역 데이터를 JSON 파일로 내보내기
- **"New Session"**: 반영 완료 후 새로운 작업 시작

---

## 시트 결과물

### Tool_Status 컬럼

툴이 시트를 처음 로드할 때 자동으로 맨 우측에 `Tool_Status` 컬럼을 생성합니다.
각 행의 작업 상태를 추적합니다.

| 상태 | 의미 | 셀 배경색 |
|------|------|----------|
| 대기 | 초기 상태, 작업 미시작 | — |
| 한국어검수완료 | 한국어 검수(Step 2) 승인 완료 | — |
| 번역중 | 번역/검수 파이프라인 진행 중 | — |
| 검수실패 | AI 검수 3회 재시도 후에도 실패 | 연빨강 |
| 최종완료 | 시트 업데이트 완료 | 연초록 |

### 셀 배경색 하이라이팅

시트에 결과를 반영할 때, **실제로 값이 변경된 셀만** 업데이트하고 배경색을 적용합니다.

| 배경색 | 색상코드 | 의미 |
|--------|---------|------|
| 하늘색 | #E0F5FE | 번역이 적용된 셀 |
| 연초록 | #DCFCE7 | 최종 완료된 셀 |
| 연빨강 | #FEE2E2 | 검수 실패한 셀 |

> 기존 번역과 새 번역이 동일한 경우 해당 셀은 업데이트하지 않습니다 (불필요한 변경 방지).

---

## 번역 기준

### AI 모델

- **모델**: Grok 4.1 Fast Reasoning (xAI)
- **처리 단위**: 15행씩 청크 배치 처리
- **재시도**: 검수 실패 시 최대 3회 자동 재시도

### 게임 시놉시스

번역 시 AI에게 제공되는 게임 세계관 컨텍스트입니다. Settings에서 편집할 수 있습니다.

> 기본값: 상자를 열기 전까지는 내용물을 알 수 없는 우주 최고 가챠 '슈뢰딩거 상자'로 대박을 터뜨린 우주 기업 카마존. 말단 배달 로봇 404가 배달 사고로 모든 상자를 잃어버리는데...

### 톤앤매너

번역의 어조와 스타일을 결정합니다. Settings에서 편집할 수 있습니다.

> 기본값: 유머러스하고 캐주얼한 톤

### Glossary (용어집) 규칙

| 규칙 | 적용 방식 |
|------|----------|
| **JA 등급명** | 강제 고정 — AI 번역 결과와 상관없이 파이썬 코드로 강제 치환 |
| **EN 등급명** | AI 자유 번역 — 시트 전체에서 일관성만 검증 |
| **커스텀 용어** | Settings에서 언어별로 추가/삭제 가능 |

**기본 JA 등급명 매핑**:

| 한국어 | 일본어 |
|--------|--------|
| 일반 | 一般 |
| 고급 | 高級 |
| 희귀 | レア |
| 영웅 | 英雄 |
| 전설 | 伝説 |
| 신화 | 神話 |
| 고대 | 古代 |

### 태그 보존

게임 클라이언트에서 사용하는 포맷팅 태그는 번역 시 100% 보존됩니다.
AI에 의존하지 않고 **정규식으로 하드코딩 검증**합니다.

| 태그 유형 | 예시 |
|----------|------|
| 변수 태그 | `{player_name}`, `{0}`, `{1}` |
| Printf 변수 | `%d`, `%s`, `%f` |
| 색상 태그 | `<color=#FF0000>`, `</color>` |
| 서식 태그 | `<b>`, `</b>`, `<i>`, `</i>` |
| 크기 태그 | `<size=20>`, `</size>` |
| 줄바꿈/탭 | `\n`, `\t` |

### Shared Comments 활용

시트의 `Shared Comments` 컬럼에 내용이 있으면, 해당 행의 번역 시 AI에게 참고 컨텍스트로 전달됩니다.
특정 행에 대한 번역 지침이나 참고사항을 적어두면 번역 품질이 향상됩니다.

---

## 설정 (Settings)

화면 하단의 톱니바퀴 아이콘을 클릭하면 Settings 모달이 열립니다.

### AI Prompting 탭

| 항목 | 설명 |
|------|------|
| **Game Synopsis** | 게임 시놉시스 — 번역 시 세계관 컨텍스트로 활용 |
| **Tone & Manner** | 톤앤매너 — 번역의 어조/스타일 지정 |
| **Custom AI Instructions** | 시트별 커스텀 프롬프트 — 해당 시트 번역 시 추가 지침으로 활용 |

> Game Synopsis와 Tone & Manner는 모든 시트에 공통 적용됩니다.
> Custom AI Instructions는 선택한 시트에만 적용됩니다.

### Glossary 탭

| 기능 | 설명 |
|------|------|
| **언어 선택** | JA / EN 버튼으로 언어 전환 |
| **용어 추가** | 한국어 원문 → 대상 언어 번역 입력 후 Enter |
| **용어 삭제** | 각 항목 우측의 삭제 버튼 클릭 |

> 추가/삭제한 용어는 즉시 서버에 저장되며, 다음 번역 시 자동 적용됩니다.

---

## 다운로드 가능 파일

작업 과정에서 아래 파일들을 CSV로 다운로드할 수 있습니다.

| 파일 | 설명 | 다운로드 시점 |
|------|------|-------------|
| **Backup** | 작업 전 원본 데이터 백업 | Step 2 (KR Review) |
| **KO Report** | 한국어 수정 제안 목록 (기존 → 수정안) | Step 2 (KR Review) |
| **Translation Report** | 기존/신규 번역 비교 + 변경 사유 | Step 4 (Multi-Review) |
| **Failed Rows** | 검수 실패 항목 목록 + 실패 사유 | Step 4 (Multi-Review) |
| **Logs** | 전체 작업 로그 | 전 단계 |

---

## FAQ / 주의사항

### 시트가 연결되지 않아요
- 봇 이메일(`local-agent@local-488014.iam.gserviceaccount.com`)이 **편집자** 권한으로 초대되었는지 확인하세요.
- URL이 구글 스프레드시트의 전체 URL인지 확인하세요.

### 특정 시트 탭이 드롭다운에 보이지 않아요
- `사용법`, `Texture`, `수정금지_Common` 시트는 시스템에서 자동 필터링됩니다.
- 이 시트들은 번역 대상이 아닌 시스템 시트입니다.

### "검수실패"로 표시된 행이 있어요
- AI 번역 후 3회 검수를 시도했지만 태그/Glossary 검증을 통과하지 못한 행입니다.
- 해당 행의 번역을 수동으로 확인하고 수정해주세요.
- Failed Rows 다운로드에서 상세 실패 사유를 확인할 수 있습니다.

### All Sheets 모드에서 Row Range를 설정할 수 없어요
- All Sheets 모드는 각 시트의 전체 행을 자동 처리합니다.
- 행 범위를 지정하려면 개별 시트 탭을 선택하세요.

### 번역 중에 브라우저를 닫으면 어떻게 되나요?
- 세션은 서버에서 유지됩니다.
- 같은 브라우저에서 다시 접속하면 진행 중이던 세션을 자동으로 복원합니다.

### 번역 비용은 얼마나 드나요?
- AI 모델: Grok 4.1 Fast Reasoning
- Input: $0.20 / 1M 토큰
- Output: $0.50 / 1M 토큰
- Cached Input: $0.05 / 1M 토큰
- 완료 화면(Step 5)에서 실제 사용된 토큰 수와 예상 비용을 확인할 수 있습니다.

### 시트의 기존 데이터가 손상될까요?
- 작업 시작 전 자동으로 원본 데이터를 백업합니다.
- **"Push to Sheets" 버튼을 클릭하기 전까지** 시트에 어떠한 변경도 가해지지 않습니다.
- 반영 시에도 실제로 값이 변경된 셀만 업데이트합니다.

---

## 필수 시트 컬럼 구조

번역 대상 시트는 아래 컬럼을 포함해야 합니다:

| 컬럼명 | 필수 | 설명 |
|--------|------|------|
| Key | O | 고유 식별자 (행 구분용) |
| Shared Comments | - | 번역 참고사항 (있으면 AI에 전달) |
| Korean(ko) | O | 한국어 원문 |
| English(en) | O | 영어 번역 (번역 대상) |
| Japanese(ja) | O | 일본어 번역 (번역 대상) |
| Tool_Status | 자동생성 | 작업 상태 추적 (툴이 자동 생성) |
